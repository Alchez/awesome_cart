{% from "templates/includes/awesome_form_macros.html" import address_form, editable_radio_list %}

{% macro embed_gateways_styles(gateway_forms) %}

	<style type="text/css">
	    {% include "templates/includes/gateway_form.css" %}
	</style>
	{% for name, gateway in gateway_forms.items() %}
	    {% if gateway.get("styles", False) %}
	        {% for src in gateway.scripts %}
	            <link href="{{ href }}" rel="stylesheet" type="text/css"/>
	        {% endfor %}
	    {% endif %}
	{% endfor %}

{% endmacro %}

{% macro embed_gateways_scripts(gateway_forms) %}

	{% for name, gateway in gateway_forms.items() %}
	    {% if gateway.get("scripts", False) %}
	        {% for src in gateway.scripts %}
	            <script src="{{ src }}" type="text/javascript"></script>
	        {% endfor %}
	    {% endif %}
	{% endfor %}

{% endmacro %}

{% macro embed_shipping(aw_goto, submit_label="Continue", countries=[], shipping_address_source="awesome_cart.datasource.addresses") -%}

<div id="shipping-form">
	<div class="dti-form">
		<div id="shipping-fields">
			{{ address_form(
				"Shipping Info.", 
				False, 
				field_prefix="ship_", 
				countries=countries, 
				address_source=shipping_address_source,
				primary_field='is_shipping_address',
				display_title=True) 
			}}
		</div>
		<div id="shipping-carriers">
			<div class="title">Delivery Method</div>
			<div class="carriers">
			</div>
		</div>

		<div id="actions">
		    <button {% if aw_goto %}data-aw-goto="{{ aw_goto }}"{% endif %} class="btn btn-primary pay-btn">{{ submit_label }}</button>
		</div>
	</div>
</div>

{%- endmacro %}

{% macro embed_gateways(gateway_forms, has_stored_payments, enable_billing_address, aw_goto, current_date, submit_label="Continue", countries=[], billing_address_source="awesome_cart.datasource.addresses") -%}

<div id="gateway-form">
	<div id="gateway-selectors">
	<div class="title">Select Payment Method</div>

	{% set default_class = "selected" %}

	{% for name, gateway in gateway_forms.items() %}

		{% set gateway_id = name.strip().lower().replace(" ", "_") %}

		<div id="gateway-{{ gateway_id }}"
		 class="selector {{ default_class }}"
		 data-ref="#fields-{{ gateway_id }}">

		<div class="icon {{ gateway.icon }}"></div>
		<input type="radio"
			   name="gateway"
			   class="small-title"
			   value="{{ gateway_id }}"
			   id="selector-{{ gateway_id}}">

		<label for="selector-{{ gateway_id }}">{{ gateway.small_title }}</label>
		</div>

		{% set default_class = "" %}
	{% endfor %}
	</div>

	{% if has_stored_payments %}
	<div id="stored-payments">
		<div class="title">Or Select Stored Payment Information</div>
		<div class="editor">
			{{ editable_radio_list("stored_payment", "store_payment", "awesome_cart.datasource.stored_payment", None) }}
		</div>
	</div>
	{% endif %}

	<div id="gateway-fields">
	{% for name, gateway in gateway_forms.items() %}
		{% set gateway_id = name.strip().lower().replace(" ", "_") %}
		<div id="fields-{{ gateway_id }}"
			class="gateway dti-form"
			data-on-visible-focus=".field:first"
			data-gateway-id="{{ gateway_id }}"
			data-gateway="{{ name }}"
			{% if gateway.requires_billing_address %}
			data-display-on-show="#billing-fields"
			{% endif %}>
			<div class="content">
				<div class="title">{{ gateway.title }}</div>
				{% include gateway.template %}
				{% if gateway.requires_billing_address %}
					{{ address_form(
						"Billing Info.", 
						False, 
						field_prefix="bill_", 
						countries=countries, 
						address_source=billing_address_source,
						primary_field='is_primary_address',
						display_title=True) 
					}}
				{% endif %}
				<div id="actions">
				    <button {% if aw_goto %}data-aw-goto="{{ aw_goto }}"{% endif %} class="btn btn-primary pay-btn">{{ submit_label }}</button>
				</div>
			</div>
		</div>
	{% endfor %}
	</div>

</div>

{%- endmacro %}

